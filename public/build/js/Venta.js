document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("codigoProducto"),e=document.getElementById("tablaProductos").querySelector("tbody"),n=document.getElementById("subtotalVenta"),o=document.getElementById("ivaVenta"),d=document.getElementById("totalVenta"),c=document.getElementById("entregaDomicilio"),a=document.getElementById("formularioEntrega");let r=[];function i(){e.innerHTML="";let t=0;r.forEach(((n,o)=>{const d=n.precio*n.cantidad;t+=d;const c=document.createElement("tr");c.innerHTML=`\n                <td>${n.codigo}</td>\n                <td>${n.nombre}</td>\n                <td>C$ ${n.precio.toFixed(2)}</td>\n                <td>\n                    <input type="number" min="1" value="${n.cantidad}" class="form-control form-control-sm cantidad" data-index="${o}">\n                </td>\n                <td>C$ ${d.toFixed(2)}</td>\n                <td><button class="btn btn-danger btn-sm eliminar" data-index="${o}">X</button></td>\n            `,e.appendChild(c)}));const c=.15*t,a=t+c;n.textContent=t.toFixed(2),o.textContent=c.toFixed(2),d.textContent=a.toFixed(2),document.querySelectorAll(".cantidad").forEach((t=>{t.addEventListener("change",(t=>{const e=t.target.dataset.index,n=parseInt(t.target.value);n>0&&(r[e].cantidad=n,i())}))})),document.querySelectorAll(".eliminar").forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.dataset.index;r.splice(e,1),i()}))}))}t.addEventListener("keydown",(async e=>{if("Enter"===e.key){e.preventDefault();const n=t.value.trim();""!==n&&(await async function(t){try{const e=await fetch(`/api/producto?codigo=${encodeURIComponent(t)}`),n=await e.json();if(!e.ok||!n||!n.idproducto)return void alert("Producto no encontrado");const o=r.find((t=>t.codigo===n.codigo_producto));o?o.cantidad++:r.push({id:n.idproducto,codigo:n.codigo_producto,nombre:n.nombre_producto,precio:parseFloat(n.precio),cantidad:1}),i()}catch(t){console.error(t),alert("Error al consultar el producto")}}(n),t.value="")}})),c.addEventListener("change",(()=>{a.style.display=c.checked?"block":"none"}))}));